<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Scheduler</title>
</head>
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>

<body>
<h1 style="text-align: center" id="title">Welcome to Scheduler</h1>
<div style="text-align: center">
    <div id="createScheduleDiv">
        <button onclick="window.location.href = './CreateMeetingPage.html'"/>
        Create Schedule</button>
    </div>

    <div style="text-align: center; margin-top: 5%;">
        <p id="errMessage" style="color: red;">

        </p>


    </div>

    <div style="text-align: center; margin-top: 5%;">
        <form id="scheduleForm" name="scheduleForm" onsubmit="JavaScript:handleGetClick()">
            <label style="margin-bottom: 15px; display: block;">
                If you are a participant, enter ScheduleID you wish to access:
                <input id="scheduleID" type="text" required>
                <br>
            </label>


            <label style="margin-bottom: 15px; display: block;">
                <input id="createButton" type="button" value="Submit" onClick="JavaScript:handleGetClick()">
                <br>
            </label>

        </form>
    </div>

    <div id="changeWeekButtons" style="margin-top: 10%; visibility: hidden;">
        <div style="float: left;">
            <input type="button" value="Previous Week" onClick="JavaScript:generateSchedule(-1)">
        </div>
        <div style="float: right;">
            <input type="button" value="Next Week" onClick="Javascript:generateSchedule(1)">
        </div>
        <br>
        <br>
    </div>
    <div id="calendarDiv"></div>


</div>

<div id="OrganizerButtonToggle" style="text-align: center; display: none; margin-top: 5%;">
    <input type="button" value="If you are the organizer, click here" onclick="JavaScript:toggleOrganizerDiv()">
    <input type="button" value="Filtering results here" onclick="JavaScript:toggleFilterDiv()">

</div>

<div id="organizerDiv"
     style="text-align: center; border-width: 2px; border-color: black; margin-top: 20px; display: none;">
    <p style="color: salmon;">By having the organizer panel open, participant functions are disabled.</p>


    <div style="display: flex;">
        <div style="width: 33%; margin-left: auto; margin-right: auto;">
            <h3>Delete Schedule</h3>
            <form id="deleteForm" onsubmit="JavaScript:deleteSchedule()">
                <label>
                    What is the Secret Key?
                    <input id="secretKey" type="text" required/>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    What is the Schedule ID?
                    <input id="scheduleIDDelete" type="text" required>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    <input id="deleteMeetingButton" type="button" value="Submit" onClick="JavaScript:deleteSchedule()">
                    <br>
                </label>
            </form>
            <P id="deleteErrorMessage" style="color: red;"></P>
        </div>

        <div style="width: 33%; margin-left: auto; margin-right: auto;">
            <h3>Cancel Meeting</h3>
            <form onsubmit="JavaScript:organizerCancelMeeting()">
                <label>
                    What is the Schedule Secret Key?
                    <input id="cancelMeetingSecretKey" type="text" required/>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    Selected Time Slot has an ID of:
                    <input id="organizerCancelMeetingID" type="text" readonly>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    <input id="organizerCancelMeetingButton" type="button" value="Submit"
                           onClick="JavaScript:organizerCancelMeeting()">
                    <br>
                </label>
            </form>
            <P id="organizerDeleteErrorMessage" style="color: red;"></P>
            <label id="organizerDeleteReload" style="margin-bottom: 15px; display: none;">
                <input type="button" value="Reload" onClick="JavaScript:handleGetClick()">
                <br>
            </label>
        </div>

        <div style="width: 33%; margin-left: auto; margin-right: auto;">
            <h3 id="closeOpenH3">Close/Open TimeSlot</h3>
            <form onsubmit="JavaScript:chooseOpenClose()">
                <label>
                    What is the Schedule Secret Key?
                    <input id="closeMeetingSecretKey" type="text" required/>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    Selected Time Slot has an ID of:
                    <input id="organizerCloseMeetingID" type="text" readonly>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    <input id="organizerCloseMeetingButton" type="button" value="Submit"
                           onClick="JavaScript:chooseOpenClose()">
                    <br>
                </label>
            </form>
            <P id="organizerCloseErrorMessage" style="color: red;"></P>
            <label id="organizerCloseReload" style="margin-bottom: 15px; display: none;">
                <input type="button" value="Reload" onClick="JavaScript:handleGetClick()">
                <br>
            </label>

        </div>

    </div>


    <div style="display: flex;">

        <div style="width: 33%; margin-left: auto; margin-right: auto;">
            <h3>Close/Open Timeslots for a whole day</h3>
            <form onsubmit="JavaScript:closeOpenTimeslotsDay()">
                <label>
                    What is the Schedule Secret Key?
                    <input id="closeOpenTimeslotSecretKey" type="text" required/>
                    <br>
                </label>
                <label>
                    What would you like to do?
                    <select id="closeOpenTimeslotDateID" name="startTime">
                        <option selected='selected' value=Close>Close</option>
                        <option value=Open>Open</option>
                    </select>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    Date for which to apply to:
                    <input id="closeOpenTimeslotDate" type="date" required>
                </label>

                <label style="margin-bottom: 15px; display: block;">
                    <input id="closeOpenTimeslotButton" type="button" value="Submit"
                           onClick="JavaScript:closeOpenTimeslotsDay()">
                    <br>
                </label>
            </form>
            <P id="closeOpenTimeslotsDayMessage" style="color: red;"></P>
            <label id="closeOpenTimeslotsDayReload" style="margin-bottom: 15px; display: none;">
                <input type="button" value="Reload" onClick="JavaScript:handleGetClick()">
                <br>
            </label>
        </div>

        <div style="width: 33%; margin-left: auto; margin-right: auto;">
            <h3>Extend Start Date/End Date</h3>
            <form onsubmit="JavaScript:checkExtendStartEndDate()">
                <label>
                    What is the Schedule Secret Key?
                    <input id="extendStartEndDateSecretKey" type="text" required/>
                    <br>
                </label>
                <label>
                    Which would you like to extend?
                    <select id="extendStartEndDateSelect">
                        <option selected="selected" value='End Date'>End Date</option>
                        <option value='Start Date'>Start Date</option>
                    </select>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    Date for which to apply to:
                    <input id="extendStartEndDateDate" type="date" required>
                </label>

                <label style="margin-bottom: 15px; display: block;">
                    <input id="extendStartEndDateButton" type="button" value="Submit"
                           onClick="JavaScript:checkExtendStartEndDate()">
                    <br>
                </label>
            </form>
            <P id="extendStartEndDateMessage" style="color: red;"></P>
            <label id="extendStartEndDateReload" style="margin-bottom: 15px; display: none;">
                <input type="button" value="Reload" onClick="JavaScript:handleGetClick()">
                <br>
            </label>
        </div>

        <div style="width: 33%; margin-left: auto; margin-right: auto;">
            <h3>Close/Open all Timeslots for a Time </h3>
            <form onsubmit="JavaScript:closeOpenTime()">
                <label>
                    What is the Schedule Secret Key?
                    <input id="closeOpenTimeSecretKey" type="text" required/>
                    <br>
                </label>
                <label>
                    What would you like to do?
                    <select id="closeOpenTimeDateID" name="startTime">
                        <option selected='selected' value=Close>Close</option>
                        <option value=Open>Open</option>
                    </select>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    Time for which to apply to:
                    <input id="hourCloseOpen" placeholder="12" style="width: 14px;" maxlength="2" pattern="\d*" type="text"
                           required>:
                    <input id="minutesCloseOpen" placeholder="30" style="width: 14px;" maxlength="2" pattern="\d*"
                           type="text" required>
                </label>

                <label style="margin-bottom: 15px; display: block;">
                    <input id="closeOpenTimeButton" type="button" value="Submit"
                           onClick="JavaScript:closeOpenTime()">
                    <br>
                </label>
            </form>
            <P id="closeOpenTimeDayMessage" style="color: red;"></P>
            <label id="closeOpenTimeDayReload" style="margin-bottom: 15px; display: none;">
                <input type="button" value="Reload" onClick="JavaScript:handleGetClick()">
                <br>
            </label>
        </div>

    </div>
</div>

<div id="filterDiv"
     style="text-align: center; border-width: 2px; border-color: black; margin-top: 20px; display: none;">
    <!--<p style="color: salmon;">By having the organizer panel open, participant functions are disabled.</p>-->

    Search for a list of open time slots
    (filtered by any combination of Month, Year, Day-Of-Week, Day-Of-Month, or Timeslot).

    <div style="display: flex;">
        <div style="width: 33%; margin-left: auto; margin-right: auto;">
            <h3>Filter Results</h3>
            <form id="asdgadsf" onsubmit="JavaScript:filterTimeslots()">
                <label style="margin-bottom: 15px; display: block;">
                    Filter by Month:
                    <select id="monthFilter">
                        <option selected="selected" value=0>None</option>
                        <option value=1>January</option>
                        <option value=2>February</option>
                        <option value=3>March</option>
                        <option value=4>April</option>
                        <option value=5>May</option>
                        <option value=6>June</option>
                        <option value=7>July</option>
                        <option value=8>August</option>
                        <option value=9>September</option>
                        <option value=10>October</option>
                        <option value=11>November</option>
                        <option value=12>December</option>
                    </select>
                </label>

                <label style="margin-bottom: 15px; display: block;">
                    Filter by Year:
                    <input id="yearFilter" placeholder="2018" style="width: 30px;" maxlength="4" pattern="\d*"
                           id="gasdfasdf" type="text" required>
                </label>

                <label style="margin-bottom: 15px; display: block;">
                    Filter by Day:
                    <select id="dayFilter">
                        <option selected="selected" value=0>None</option>
                        <option value=1>Monday</option>
                        <option value=2>Tuesday</option>
                        <option value=3>Wednesday</option>
                        <option value=4>Thursday</option>
                        <option value=5>Friday</option>
                    </select>
                </label>

                <label style="margin-bottom: 15px; display: block;">
                    Filter by Day of Month:
                    <input id="dayOfMonthFilter" placeholder="23" style="width: 14px;" maxlength="2" pattern="\d*"
                           type="text" required>
                </label>

                <label style="margin-bottom: 15px; display: block;">
                    Filter by Timeslot:
                    <input id="hourFilter" placeholder="12" style="width: 14px;" maxlength="2" pattern="\d*" type="text"
                           required>:
                    <input id="minutesFilter" placeholder="30" style="width: 14px;" maxlength="2" pattern="\d*"
                           type="text" required>

                </label>

                <label style="margin-bottom: 15px; display: block;">
                    <input type="button" value="Submit" onClick="JavaScript:filterTimeslots()">
                </label>

                <br>
            </form>
            <P id="asvadfvds" style="color: red;"></P>
        </div>
    </div>
</div>


<div id="meetingDiv" style="display: none">
    <h3>For Attendee: Create Meeting</h3>
    <form id="meetingForm" name="meetingForm" onsubmit="JavaScript:createMeeting()">
        <label>
            Your selected Timeslot has an ID of:
            <input id="timeslotKeyField" style="" readonly/>
        </label>
        <label style="margin-bottom: 15px; display: block;">
            If you are a participant, enter your name below to reserve the timeslot:
            <input id="nameTimeslot" type="text" required>

        </label>

        <label style="margin-bottom: 15px; display: block;">
            <input id="createMeetingButton" type="button" value="Create Meeting" onClick="JavaScript:createMeeting()">
            <br>
        </label>
    </form>
    <P id="scheduleMeetingErrorMessage" style="color: red;"></P>
    <form id="confirmMeetingForm" style="display: none;" onsubmit="JavaScript:handleGetClick()">
        <label>
            Your secret key is:
            <input id="meetingSecretKeyField" style="" readonly/>
        </label>
        <p>
            Press 'Reload' to reload once you have copied down your key.
        </p>
        <label style="margin-bottom: 15px; display: block;">
            <input type="button" value="Reload" onClick="JavaScript:handleGetClick()">
            <br>
        </label>
    </form>
</div>

<div id="cancelMeetingDiv" style="display: none">
    <h3>For Attendee: Cancel Meeting</h3>
    <form id="cancelMeetingForm" name="meetingForm" onsubmit="JavaScript:deleteMeeting()">
        <label>
            Your selected Timeslot has an ID of:
            <input id="timeslotKeyField2" style="" readonly/>
        </label>
        <label style="margin-bottom: 15px; display: block;">
            This timeslot is reserved by:
            <input id="nameTimeslot2" type="text" readonly>
        </label>

        <label>
            Enter the secret key you were given when scheduled to continue:
            <input id="meetingSecretKey" type="text" required>
        </label>

        <label style="margin-bottom: 15px; display: block;">
            <input id="cancelMeetingButton" type="button" value="Delete Meeting" onClick="JavaScript:deleteMeeting()">
            <br>
        </label>
    </form>
    <P id="cancelScheduleMeetingErrorMessage" style="color: red;"></P>
    <form id="confirmCancelMeetingForm" style="display: none;" onsubmit="JavaScript:handleGetClick()">
        <p>
            Press 'Reload' to reload once you have copied down your key.
        </p>
        <label style="margin-bottom: 15px; display: block;">
            <input type="button" value="Reload" onClick="JavaScript:handleGetClick()">
            <br>
        </label>
    </form>
</div>
<div>
    <p style="color: salmon; display: none;" id="filterMessage">Sorry, no timeslots match your criteria. Try Again!</p>

    <div id="filterDivResults" style="display: none; text-align: center">

    </div>
</div>

<div>
    <p style="color: salmon; display: none;" id="adminMessage">Sorry that is invalid</p>

    <div id="adminDiv" style="display: none; text-align: center">
        <div style="display: flex;">
        <div style="width: 33%; margin-left: auto; margin-right: auto;">
            <h3>Close/Open all Timeslots for a Time </h3>
            <form onsubmit="JavaScript:adminDeleteSchedules()">
                <label>
                    What is the Admin Secret Key (Hint: Type anything)?
                    <input id="adminSecretKey" type="text" required/>
                    <br>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    Delete schedules created in the past amount of days:
                    <input id="deleteDaysBefore" placeholder="5" style="width: 14px;" maxlength="2" pattern="\d*" type="text"
                           required>
                </label>

                <label style="margin-bottom: 15px; display: block;">
                    <input id="adminDeleteButton" type="button" value="Submit"
                           onClick="JavaScript:adminDeleteSchedules()">
                    <br>
                </label>
            </form>
            <P id="adminDeleteMessage" style="color: red;"></P>
            <label id="adminDeleteReload" style="margin-bottom: 15px; display: none;">
                <input type="button" value="Reload" onClick="reload()">
                <br>
            </label>
        </div>

        <div style="width: 33%; margin-left: auto; margin-right: auto;">
            <h3>Get Recent Schedules </h3>
            <form onsubmit="JavaScript:getAdminSchedules()">
                <label>
                    What is the Admin Secret Key (Hint: Type anything)?
                    <input id="getSchedulesAdminSecretKey" type="text" required/>
                    <br>
                </label>
                <label style="margin-bottom: 15px; display: block;">
                    Get schedules created in the past amount of hours:
                    <input id="getCreated" placeholder="2" style="width: 14px;" maxlength="4" pattern="\d*" type="text"
                           required>
                </label>

                <label style="margin-bottom: 15px; display: block;">
                    <input  type="button" value="Submit"
                           onClick="JavaScript:getAdminSchedules()">
                    <br>
                </label>
            </form>
            <P id="adminGetSchedulesMessage" style="color: red;"></P>
            <label id="adminGetReload" style="margin-bottom: 15px; display: none;">
                <input type="button" value="Clear Results" onClick="clearDiv()">
                <br>
            </label>
        </div>

        </div>
    </div>
    <div id="adminResultDiv" style="display: none; text-align: center">

    </div>

</div>

<div style="height: 150px;">

</div>


<div style="position: fixed;z-index: -1; left: 0; bottom: 15px; width: 100%; margin-top: 5%; color: white; text-align: center;">
    <input type="button" value="Enter Admin panel here" onclick="JavaScript:toggleAdminDiv()">
</div>

<script>

    var weekNum;
    var js = {};
    var beginningDate;
    var endingDate;
    var startDate;
    var endDate;


    var getURL = 'https://0ssnizv9l4.execute-api.us-east-2.amazonaws.com/alpha/getschedule';
    var deleteURL = 'https://gh13hei2z1.execute-api.us-east-2.amazonaws.com/alpha/deleteschedule';
    var scheduleMeetingURL = 'https://bf8e9h7l2j.execute-api.us-east-2.amazonaws.com/alpha/schedulemeeting'
    var deleteMeetingsURL = 'https://ejsjv6iale.execute-api.us-east-2.amazonaws.com/alpha/deletemeeting';
    var deleteMeetingOrganizerURL = 'https://rfz4c5o1lf.execute-api.us-east-2.amazonaws.com/alpha/deletemeetingbyorginizer';
    var closeMeetingOrganizerURL = 'https://x0o3pw5l8k.execute-api.us-east-2.amazonaws.com/alpha/closesingletimeslot';
    var openMeetingOrganizerURL = 'https://coph493euh.execute-api.us-east-2.amazonaws.com/alpha/opensingletimeslot';
    var closeTimeslotForDayURL = 'https://d5w374sfbg.execute-api.us-east-2.amazonaws.com/alpha/closetimeslotsforday';
    var openTimeslotForDayURL = 'https://0pnegnnijb.execute-api.us-east-2.amazonaws.com/alpha/opentimeslotsforday';
    var extendScheduleEndURL = 'https://cq7o8jmsf7.execute-api.us-east-2.amazonaws.com/alpha/extandenddate';
    var extendScheduleStartURL = 'https://5j7vupkxzd.execute-api.us-east-2.amazonaws.com/alpha/extendstartdate';
    var closeAllForTimeURL = 'https://9rr7plmv95.execute-api.us-east-2.amazonaws.com/alpha/closetimeslotsfortime';
    var openAllForTimeURL = 'https://7sps76eb4e.execute-api.us-east-2.amazonaws.com/alpha/opentimeslotsfortime';
    var adminDeleteURL = 'https://j0kosd3lx6.execute-api.us-east-2.amazonaws.com/alpha/deleteoldschedules';
    var adminGetURL = 'https://l50g67ple9.execute-api.us-east-2.amazonaws.com/alpha/getoldschedules\n';


    function handleGetClick() {
        event.preventDefault();
        if (document.getElementById("scheduleID").value == "")
            alert("Please Enter a Valid ScheduleID");
        else {
            $("body").css("cursor", "progress");
            var scheduleID = document.getElementById("scheduleID").value;
            //document.getElementById("scheduleForm").style.visibility = "hidden";
            document.getElementById("scheduleForm").style.display = "none";
            //document.getElementById("createScheduleDiv").style.visibility = "hidden";
            document.getElementById("createScheduleDiv").style.display = "none";
            var getString = {};
            getString["scheduleID"] = scheduleID;
            var js = JSON.stringify(getString);

            var xhr = new XMLHttpRequest();
            xhr.open("POST", getURL, true);

            // send the collected data as JSON
            xhr.send(js);

            // This will process results and update HTML as appropriate.
            xhr.onloadend = function () {
                console.log(xhr);
                console.log(xhr.request);

                if (xhr.readyState == XMLHttpRequest.DONE) {
                    $("body").css("cursor", "default");

                    console.log("XHR:" + xhr.responseText);
                    var jsonResponse = JSON.parse(xhr.responseText);

                    if (jsonResponse.httpCode == 422)
                        noScheduleFound();
                    else if (jsonResponse.httpCode == 200) {
                        js = jsonResponse;
                        weekNum = 0;
                        originalSetup(jsonResponse);
                    }
                    else
                        alert(jsonResponse.message);
                }
            };
        }
    }

    function originalSetup(json) {
        js = json;
        startDate = new Date(js.schedule.startDate.year, parseInt(js.schedule.startDate.month) - 1, js.schedule.startDate.day);
        endDate = new Date(js.schedule.endDate.year, parseInt(js.schedule.endDate.month) - 1, js.schedule.endDate.day);
        beginningDate = new Date(js.schedule.startDate.year, parseInt(js.schedule.startDate.month) - 1, js.schedule.startDate.day);
        endingDate = new Date(js.schedule.endDate.year, parseInt(js.schedule.endDate.month) - 1, js.schedule.endDate.day);
        weekNum = 0;


        generateSchedule(0);

    }

    function generateSchedule(weekNumIndicator) {
        document.getElementById('errMessage').style.visibility = 'hidden';

        document.getElementById('title').innerText = 'Welcome to the ' + js.schedule.scheduleName + ' schedule';
        document.getElementById('changeWeekButtons').style.visibility = "visible";
        weekNum += weekNumIndicator;

        if (startDate.getDay() == 0)
            startDate = new Date(startDate.getTime() + 86400000);
        else if (startDate.getDay() == 6)
            startDate = new Date(startDate.getTime() + (86400000 * 2));

        if (endDate.getDay() == 6)
            endDate = new Date(endDate.getTime() - 86400000);
        else if (endDate.getDay() == 0)
            endDate = new Date(endDate.getTime() - (86400000 * 2));


        var startTime = js.schedule.dayStartTime;
        var endTime = js.schedule.dayEndTime;
        var increment = js.schedule.timeSlotDuration;

        var numMeetings = ((endTime - startTime) * 60) / increment;

        var calDiv = document.getElementById("calendarDiv");

        var ourTable = document.createElement("table");
        var ourTableBody = document.createElement("tbody");

        var timeSlotDate = new Date(1776, 6, 4);
        var startWeekDate = new Date(beginningDate.getTime())
        //Add this to the function call
        startWeekDate = new Date(startWeekDate.getTime() + (604800000) * weekNum);
        if (weekNum != 0) {
            var testFirstDay = startWeekDate.getDay();
            startWeekDate.setDate(startWeekDate.getDate() - testFirstDay + 1)
        }
        var testDate = new Date(startWeekDate.getTime());

        var firstOccurance = 5;
        var lastOccurance = 0;
        for (var x = 0; x < js.timeSlots.length; x++) {
            if (js.timeSlots[x].dayInWeek < firstOccurance && js.timeSlots[x].week - 1 == weekNum)
                firstOccurance = js.timeSlots[x].dayInWeek;
            if (js.timeSlots[x].dayInWeek > lastOccurance && js.timeSlots[x].week - 1 == weekNum)
                lastOccurance = js.timeSlots[x].dayInWeek;
        }


        var shouldAdd = false;
        var shouldBuild = false;
        var shouldDatesBuild = true;
        var current = 0;
        var startWeekDateDay = startWeekDate.getDay();

        for (var j = 0; j < numMeetings; j++) {

            var row = document.createElement("tr");

            for (var i = startWeekDateDay - 1; i < 7; i++) {

                current = i - startWeekDateDay - 1;
                testDate = new Date(startWeekDate.getTime() + (current * 86400000));

                if (testDate <= endDate && testDate >= beginningDate) {
                    for (var x = 0; x < js.timeSlots.length; x++) {
                        //get the date of a timeslot
                        timeSlotDate = new Date(js.timeSlots[x].startTime.date.year, parseInt(js.timeSlots[x].startTime.date.month) - 1, js.timeSlots[x].startTime.date.day);

                        if ((timeSlotDate.toDateString() === testDate.toDateString()) && ((js.timeSlots[x].slotNumInDay - 1) == j)) {

                            //Building Dates on top of the table, only runs once
                            if (js.timeSlots[x].slotNumInDay == 1 && j == 0 && shouldDatesBuild) {
                                shouldDatesBuild = false;
                                var dateRow = document.createElement("tr");
                                var builderDate = new Date(testDate.getTime());

                                //Set empty cell top right corner
                                var emptyCell = true;


                                for (var y = 0; y < lastOccurance - firstOccurance + 1; y++) {
                                    builderDate = new Date(testDate.getTime() + (y * 86400000));
                                    if ((builderDate.getTime() <= endDate.getTime()) && builderDate.getDay() < 6) {

                                        //Create empty cell top right corner
                                        if (emptyCell) {
                                            emptyCell = false;
                                            var cellDate = document.createElement("td");
                                            dateRow.appendChild(cellDate);
                                        }
                                        var dayString;
                                        if (builderDate.getDay() == 1)
                                            dayString = 'Monday'
                                        else if (builderDate.getDay() == 2)
                                            dayString = 'Tuesday';
                                        else if (builderDate.getDay() == 3)
                                            dayString = 'Wednesday';
                                        else if (builderDate.getDay() == 4)
                                            dayString = 'Thursday';
                                        else if (builderDate.getDay() == 5)
                                            dayString = 'Friday';

                                        var cellDate = document.createElement("td");
                                        cellDate.style.whiteSpace = 'pre';
                                        var cellDateText = document.createTextNode(builderDate.getMonth() + 1 + '-' + builderDate.getDate() + '-' + builderDate.getFullYear() + '\u000a' + dayString);
                                        cellDate.appendChild(cellDateText);
                                        dateRow.appendChild(cellDate);
                                    }
                                }
                                ourTableBody.appendChild(dateRow);
                            }

                            shouldBuild = true;
                            shouldAdd = true;

                            //Create time slots in the beginning of rows
                            if (js.timeSlots[x].startTime.date.year == startWeekDate.getFullYear()
                                && js.timeSlots[x].startTime.date.month == startWeekDate.getMonth() + 1
                                && js.timeSlots[x].startTime.date.day == startWeekDate.getDate()
                                && js.timeSlots[x].slotNumInDay == j + 1) {
                                var cellTime = document.createElement("td");
                                if (js.timeSlots[x].startTime.time.minute == 0)
                                    var cellTimeText = document.createTextNode(js.timeSlots[x].startTime.time.hour + ":00");
                                else
                                    var cellTimeText = document.createTextNode(js.timeSlots[x].startTime.time.hour + ":" + js.timeSlots[x].startTime.time.minute);
                                cellTime.appendChild(cellTimeText);
                                row.appendChild(cellTime);
                            }

                            var cell = document.createElement("td");
                            //var cellText = document.createTextNode(js.timeSlots[x].startTime.time.minute + " " + js.timeSlots[x].startTime.date.day);
                            var scheduleButton = document.createElement("button");
                            scheduleButton.id = js.timeSlots[x].timeslotID;
                            scheduleButton.name = 'aButton';

                            if (js.timeSlots[x].isReserved == true) {
                                for (var k = 0; k < js.meetings.length; k++) {
                                    if (js.meetings[k].timeslotID == js.timeSlots[x].timeslotID) {
                                        scheduleButton.innerText = js.meetings[k].meetingName;
                                        scheduleButton.id = js.meetings[k].meetingID;
                                        cell.style.backgroundColor = 'rgba(59, 65, 255, 0.5)';
                                        break;
                                    }
                                }
                            } else if (js.timeSlots[x].isOpen == true) {
                                scheduleButton.innerText = 'OPEN';
                                cell.style.backgroundColor = 'rgba(11, 202, 11, 0.43)';
                            } else if (js.timeSlots[x].isOpen == false) {
                                scheduleButton.innerText = 'CLOSED';
                                scheduleButton.disabled = true;
                                cell.style.backgroundColor = 'rgba(255, 0, 0, 0.44)';
                            }

                            scheduleButton.className = "meetingButton";
                            cell.appendChild(scheduleButton);
                            row.appendChild(cell);
                        }
                    }
                }
            }

            if (shouldAdd)
                ourTableBody.appendChild(row);
            shouldAdd = false;
        }

        if (shouldBuild) {
            ourTable.appendChild(ourTableBody);
            ourTable.setAttribute("border", "2");
            ourTable.setAttribute("width", "100%");
            ourTable.setAttribute("margin-right", "auto");
            ourTable.setAttribute("margin-left", "auto");

            if (calDiv.hasChildNodes())
                calDiv.removeChild(calDiv.firstChild);
            calDiv.appendChild(ourTable);
            attachEventListeners();
            document.getElementById("OrganizerButtonToggle").style.display = "block";

        } else {
            alert("You have reached the limit of the Schedule. No schedule left to be generated.");
            weekNum = weekNum - weekNumIndicator;
        }
        document.getElementById('organizerDiv').style.display = 'none';
        hideDivs();
    }


    function attachEventListeners() {
        var meetingButtons = document.getElementsByClassName('meetingButton');
        for (var x = 0; x < meetingButtons.length; x++) {
            meetingButtons[x].addEventListener('click', function () {
                if (document.getElementById("organizerDiv").style.display == "block") {
                    if (this.innerText == 'OPEN' || this.innerText == 'CLOSED') {
                        if (this.innerText == 'OPEN') {
                            document.getElementById('closeOpenH3').innerText = 'Close Timeslot'
                        }
                        else {
                            document.getElementById('closeOpenH3').innerText = 'Open Timeslot'
                        }

                        document.getElementById('organizerCancelMeetingButton').disabled = true;
                        document.getElementById('organizerCloseMeetingButton').disabled = false;
                        document.getElementById('organizerCloseMeetingID').value = this.id;
                    }
                    else {
                        document.getElementById('organizerCancelMeetingID').value = this.id;
                        document.getElementById('organizerCancelMeetingButton').disabled = false;
                        document.getElementById('organizerCloseMeetingButton').disabled = true;

                    }

                } else if (this.innerText == 'OPEN') {
                    document.getElementById("meetingDiv").style.display = "block";
                    document.getElementById("cancelMeetingDiv").style.display = "none";
                    document.getElementById("timeslotKeyField").value = this.id;
                } else {
                    document.getElementById("meetingDiv").style.display = "none";
                    document.getElementById("cancelMeetingDiv").style.display = "block";
                    document.getElementById("timeslotKeyField2").value = this.id;
                    document.getElementById("nameTimeslot2").value = this.innerText;
                }
            });
        }
    }

    function closeOpenTimeslotsDay() {
        document.getElementById('closeOpenTimeslotsDayMessage').innerText = '';
        var b = document.getElementById('closeOpenTimeslotDate').value.split(/\D/);
        var pickedDate = new Date(b[0], --b[1], b[2]);
        var daysNum = pickedDate.getDate();
        var monthNum = parseInt(pickedDate.getMonth() + 1);
        if (parseInt(pickedDate.getMonth() + 1) < 10)
            monthNum = '0' + parseInt(pickedDate.getMonth() + 1);
        if (pickedDate.getDate() < 10)
            daysNum = '0' + pickedDate.getDate();
        var dateString = pickedDate.getFullYear() + '-' + monthNum + '-' + daysNum;

        if (pickedDate > endingDate || pickedDate < beginningDate)
            document.getElementById('closeOpenTimeslotsDayMessage').innerText = 'Date not a part of schedule. Try again.';

        else
            document.getElementById('closeOpenTimeslotsDayMessage').innerText = '';

        $("body").css("cursor", "progress");

        var dateModifyData;
        var secretKey = document.getElementById('closeOpenTimeslotSecretKey').value;

        var theURL;
        if (document.getElementById('closeOpenTimeslotDateID').value == 'Close') {
            theURL = closeTimeslotForDayURL;
            dateModifyData = {
                'scheduleID': js.schedule.scheduleID,
                'originizerSecretCode': secretKey,
                'closeDate': dateString
            };
        }
        else {
            theURL = openTimeslotForDayURL;
            dateModifyData = {
                'scheduleID': js.schedule.scheduleID,
                'originizerSecretCode': secretKey,
                'openDate': dateString
            };
        }


        var xhr = new XMLHttpRequest();
        xhr.open("POST", theURL, true);

        var stringified = JSON.stringify(dateModifyData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                console.log("XHR:" + xhr.responseText);
                $("body").css("cursor", "default");
                var jsonResponse = JSON.parse(xhr.responseText);

                if (jsonResponse.httpCode == 500)
                    document.getElementById('closeOpenTimeslotsDayMessage').innerText = "Error Making Meeting";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('closeOpenTimeslotsDayMessage').innerText = "Date has been modified.";
                    document.getElementById('closeOpenTimeslotSecretKey').value = '';
                    document.getElementById('closeOpenTimeslotsDayReload').style.display = "block";
                }
                else if (jsonResponse.httpCode == 422)
                    document.getElementById('closeOpenTimeslotsDayMessage').innerText = jsonResponse.message;
                else
                    alert(jsonResponse.message);
            }
        };
    }

    function closeOpenTime() {
        document.getElementById('closeOpenTimeDayMessage').innerText = '';
        
        if (document.getElementById('hourCloseOpen').value == '' || document.getElementById('minutesCloseOpen').value == ''){
            document.getElementById('closeOpenTimeDayMessage').innerText = 'Missing Arguments. Try Again.';
            return;
        }
        var pickedHour = parseInt(document.getElementById('hourCloseOpen').value);
        var pickedMinutes = parseInt(document.getElementById('minutesCloseOpen').value);

        var selectedTime = new Date((pickedHour * 3600000) + ((pickedMinutes)*60000));
        var scheduleStartTime = new Date((js.schedule.dayStartTime * 3600000));
        var scheduleEndTime = new Date((js.schedule.dayEndTime * 3600000));

        if (selectedTime >= scheduleStartTime && selectedTime <= scheduleEndTime)
            document.getElementById('closeOpenTimeDayMessage').innerText = '';
        else {
            document.getElementById('closeOpenTimeDayMessage').innerText = 'Time does not exist within schedule';
            return;
        }

        var secretKey = document.getElementById('closeOpenTimeSecretKey').value;

        var theURL;
        if (document.getElementById('closeOpenTimeDateID').value == 'Close') {
            theURL = closeAllForTimeURL;
            dateModifyData = {
                'scheduleID': js.schedule.scheduleID,
                'originizerSecretCode': secretKey,
                "hour": pickedHour,
                "minute": pickedMinutes
            };
        }
        else {
            theURL = openAllForTimeURL;
            dateModifyData = {
                'scheduleID': js.schedule.scheduleID,
                'originizerSecretCode': secretKey,
                "hour": pickedHour,
                "minute": pickedMinutes
            };
        }

        $("body").css("cursor", "progress");
        var xhr = new XMLHttpRequest();
        xhr.open("POST", theURL, true);

        var stringified = JSON.stringify(dateModifyData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                console.log("XHR:" + xhr.responseText);
                $("body").css("cursor", "default");
                var jsonResponse = JSON.parse(xhr.responseText);

                if (jsonResponse.httpCode == 500)
                    document.getElementById('closeOpenTimeDayMessage').innerText = "Error Making Meeting";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('closeOpenTimeDayMessage').innerText = "Date has been modified.";
                    document.getElementById('closeOpenTimeSecretKey').value = '';
                    document.getElementById('closeOpenTimeDayReload').style.display = "block";
                }
                else if (jsonResponse.httpCode == 422)
                    document.getElementById('closeOpenTimeDayMessage').innerText = jsonResponse.message;
                else
                    alert(jsonResponse.message);
            }
        };
    }

    function checkExtendStartEndDate() {
        if (document.getElementById('extendStartEndDateDate').value == '' || document.getElementById('extendStartEndDateSecretKey').value == '' || document.getElementById('extendStartEndDateSelect').value == '')
            document.getElementById('extendStartEndDateMessage').innerText = 'Fields are missing.';
        else
            extendStartEndDate()
    }


    function extendStartEndDate() {
        document.getElementById('extendStartEndDateMessage').innerText = '';
        var b = document.getElementById('extendStartEndDateDate').value.split(/\D/);
        var pickedDate = new Date(b[0], --b[1], b[2]);
        var daysNum = pickedDate.getDate();
        var monthNum = parseInt(pickedDate.getMonth() + 1);
        if (parseInt(pickedDate.getMonth() + 1) < 10)
            monthNum = '0' + parseInt(pickedDate.getMonth() + 1);
        if (pickedDate.getDate() < 10)
            daysNum = '0' + pickedDate.getDate();
        var dateString = pickedDate.getFullYear() + '-' + monthNum + '-' + daysNum;
        var inputDateGood = false;

        var dateModifyData;
        var secretKey = document.getElementById('extendStartEndDateSecretKey').value;

        var theURL;

        if (document.getElementById('extendStartEndDateSelect').value == 'End Date') {
            if (pickedDate < endingDate)
                document.getElementById('extendStartEndDateMessage').innerText = 'Date must be past the current end date.';
            else
                inputDateGood = true;

            theURL = extendScheduleEndURL;
            dateModifyData = {
                'scheduleID': js.schedule.scheduleID,
                'originizerSecretCode': secretKey,
                'newDate': dateString
            };
        } else {
            if (pickedDate > beginningDate)
                document.getElementById('extendStartEndDateMessage').innerText = 'Date must be before the current end date.';
            else
                inputDateGood = true;

            theURL = extendScheduleStartURL;
            dateModifyData = {
                'scheduleID': js.schedule.scheduleID,
                'originizerSecretCode': secretKey,
                'newStartDate': dateString
            };
        }

        if (inputDateGood) {
            $("body").css("cursor", "progress");

            var xhr = new XMLHttpRequest();
            xhr.open("POST", theURL, true);

            var stringified = JSON.stringify(dateModifyData);

            xhr.send(stringified);
            xhr.onloadend = function () {
                console.log(xhr);
                console.log(xhr.request);

                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log("XHR:" + xhr.responseText);
                    $("body").css("cursor", "default");
                    var jsonResponse = JSON.parse(xhr.responseText);

                    if (jsonResponse.httpCode == 500)
                        document.getElementById('extendStartEndDateMessage').innerText = "Error Making Meeting";
                    else if (jsonResponse.httpCode == 200) {
                        document.getElementById('extendStartEndDateMessage').innerText = "Extension has been made.";
                        document.getElementById('extendStartEndDateSecretKey').value = '';
                        document.getElementById('extendStartEndDateReload').style.display = "block";
                    }
                    else if (jsonResponse.httpCode == 422)
                        document.getElementById('extendStartEndDateMessage').innerText = jsonResponse.message;
                    else
                        alert(jsonResponse.message);
                }
            };
        }
    }

    function filterTimeslots() {
        document.getElementById("filterDivResults").innerHTML = '';
        document.getElementById('filterMessage').style.display = 'none';

        var filteredTimeslots = [];
        var placementArray = [];
        var numSelected = 0;

        var monthFilter = parseInt(document.getElementById('monthFilter').value);
        var yearFilter = parseInt(document.getElementById('yearFilter').value);
        var dayFilter = parseInt(document.getElementById('dayFilter').value);
        var dayOfMonthFilter = parseInt(document.getElementById('dayOfMonthFilter').value);
        var hourFilter = parseInt(document.getElementById('hourFilter').value);
        var minuteFilter = parseInt(document.getElementById('minutesFilter').value);


        if (monthFilter != 0)
            numSelected++;
        if (yearFilter)
            numSelected++;
        if (dayFilter != 0)
            numSelected++;
        if (dayOfMonthFilter)
            numSelected++;
        if (hourFilter && minuteFilter)
            numSelected++;

        if (numSelected != 0) {
            for (var x = 0; x < js.timeSlots.length; x++) {
                if (js.timeSlots[x].isOpen == true && js.timeSlots[x].isReserved == false) ;
                placementArray.push(js.timeSlots[x])
            }

            filteredTimeslots = placementArray;
            placementArray = [];

            if (monthFilter != 0) {
                for (var x = 0; x < filteredTimeslots.length; x++) {
                    if (filteredTimeslots[x].startTime.date.month == monthFilter)
                        placementArray.push(filteredTimeslots[x])
                }
                filteredTimeslots = placementArray;
                placementArray = [];
            }

            if (yearFilter) {
                for (var x = 0; x < filteredTimeslots.length; x++) {
                    if (filteredTimeslots[x].startTime.date.year == yearFilter)
                        placementArray.push(filteredTimeslots[x])
                }
                filteredTimeslots = placementArray;
                placementArray = [];
            }

            if (dayFilter != 0) {
                for (var x = 0; x < filteredTimeslots.length; x++) {
                    if (filteredTimeslots[x].dayInWeek == dayFilter)
                        placementArray.push(filteredTimeslots[x])
                }
                filteredTimeslots = placementArray;
                placementArray = [];
            }

            if (dayOfMonthFilter) {
                for (var x = 0; x < filteredTimeslots.length; x++) {
                    if (filteredTimeslots[x].startTime.date.day == dayOfMonthFilter)
                        placementArray.push(filteredTimeslots[x])
                }

                filteredTimeslots = placementArray;
                placementArray = [];
            }

            if (hourFilter && minuteFilter) {
                for (var x = 0; x < filteredTimeslots.length; x++) {
                    if (filteredTimeslots[x].startTime.time.hour == hourFilter && filteredTimeslots[x].startTime.time.minute == minuteFilter)
                        placementArray.push(filteredTimeslots[x])
                }
                filteredTimeslots = placementArray;
            }

            var jsonTimeslots = {};
            for (var i = 0; i < filteredTimeslots.length; i++) {
                jsonTimeslots[i] = filteredTimeslots[i];
            }

            console.log(jsonTimeslots);

            if (filteredTimeslots.length > 0) {
                var body = document.getElementById("filterDivResults");

                // creates a <table> element and a <tbody> element
                var tbl = document.createElement("table");
                var tblBody = document.createElement("tbody");

                var firstRowBuilt = false;

                // creating all cells
                for (var i = 0; i < filteredTimeslots.length; i++) {
                    // creates a table row
                    var aTimeslot = filteredTimeslots[i];
                    var row = document.createElement("tr");

                    if (!firstRowBuilt) {
                        firstRowBuilt = true;
                        var topRow = document.createElement("tr");
                        var cell1 = document.createElement("td");
                        var cell2 = document.createElement("td");
                        var cell3 = document.createElement("td");
                        var cell4 = document.createElement("td");
                        var cellText1 = document.createTextNode("Selection Button");
                        //var cellText2 = document.createTextNode("Day");
                        var cellText3 = document.createTextNode("Date");
                        var cellText4 = document.createTextNode("Time");
                        cell1.appendChild(cellText1);
                        //cell2.appendChild(cellText2);
                        cell3.appendChild(cellText3);
                        cell4.appendChild(cellText4);
                        topRow.appendChild(cell1);
                        //topRow.appendChild(cell2);
                        topRow.appendChild(cell3);
                        topRow.appendChild(cell4);

                        tblBody.appendChild(topRow);
                    }

                    var cell1 = document.createElement("td");
                    var cell2 = document.createElement("td");
                    var cell3 = document.createElement("td");
                    var cell4 = document.createElement("td");

                    var scheduleButton = document.createElement("button");
                    scheduleButton.id = aTimeslot.timeslotID;
                    scheduleButton.name = 'aButton';
                    scheduleButton.className = "meetingButton";
                    scheduleButton.innerText = 'OPEN';
                    cell1.style.backgroundColor = 'rgba(11, 202, 11, 0.43)'


                    var timeslotDate = new Date(aTimeslot.startTime.date.year, parseInt(aTimeslot.startTime.date.month) - 1, aTimeslot.startTime.date.day)

                    var cellText3 = document.createTextNode(timeslotDate.toDateString());
                    var cellTimeText = '';
                    if (aTimeslot.startTime.time.minute == 0)
                        cellTimeText = aTimeslot.startTime.time.hour + ":00";
                    else
                        cellTimeText = aTimeslot.startTime.time.hour + ":" + aTimeslot.startTime.time.minute;

                    var cellText4 = document.createTextNode(cellTimeText);
                    cell1.appendChild(scheduleButton);
                    //cell2.appendChild(cellText2);
                    cell3.appendChild(cellText3);
                    cell4.appendChild(cellText4);
                    row.appendChild(cell1);
                    //row.appendChild(cell2);
                    row.appendChild(cell3);
                    row.appendChild(cell4);

                    // add the row to the end of the table body
                    tblBody.appendChild(row);
                    document.getElementById("filterDivResults").style.display = 'block';

                }

                // put the <tbody> in the <table>
                tbl.appendChild(tblBody);
                // appends <table> into <body>

                tbl.setAttribute("width", "100%");
                tbl.setAttribute("margin-right", "auto");
                tbl.setAttribute("margin-left", "auto");
                body.appendChild(tbl);
                // sets the border attribute of tbl to 2;
                tbl.setAttribute("border", "2");
                attachEventListeners();
            } else {
                document.getElementById('filterMessage').style.display = 'block';
            }

        }
    }

    function createMeeting() {
        var timeslotID = document.getElementById('timeslotKeyField').value;
        var meetingName = document.getElementById('nameTimeslot').value;
        $("body").css("cursor", "progress");

        var createMeetingData = {
            'timeslotID': timeslotID,
            'meetingName': meetingName
        };

        var xhr = new XMLHttpRequest();
        xhr.open("POST", scheduleMeetingURL, true);

        var stringified = JSON.stringify(createMeetingData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                console.log("XHR:" + xhr.responseText);
                $("body").css("cursor", "default");
                var jsonResponse = JSON.parse(xhr.responseText);

                if (jsonResponse.httpCode == 500)
                    document.getElementById('scheduleMeetingErrorMessage').innerText = "Error Making Meeting";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('scheduleMeetingErrorMessage').innerText = "Meeting Scheduled";
                    document.getElementById('timeslotKeyField').value = '';
                    document.getElementById('nameTimeslot').value = '';
                    document.getElementById('meetingSecretKeyField').value = jsonResponse.secretCode;
                    document.getElementById('confirmMeetingForm').style.display = 'block';
                }
                else
                    alert(jsonResponse.message);

            }
        };
    }

    function deleteMeeting() {
        var meetingID = document.getElementById('timeslotKeyField2').value;
        var secretCode = document.getElementById('meetingSecretKey').value;
        $("body").css("cursor", "progress");


        var deleteMeetingData = {
            'meetingID': meetingID,
            'secretCode': secretCode
        };

        var xhr = new XMLHttpRequest();
        xhr.open("POST", deleteMeetingsURL, true);

        var stringified = JSON.stringify(deleteMeetingData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                console.log("XHR:" + xhr.responseText);
                var jsonResponse = JSON.parse(xhr.responseText);
                $("body").css("cursor", "default");

                if (jsonResponse.httpCode == 500)
                    document.getElementById('scheduleMeetingErrorMessage').innerText = "Error Making Meeting";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('cancelScheduleMeetingErrorMessage').innerText = "Meeting Canceled";
                    document.getElementById('timeslotKeyField2').value = '';
                    handleGetClick();
                    //document.getElementById('nameTimeslot').value = '';
                }
                else
                    alert(jsonResponse.message);

            }
        };
    }

    function organizerCancelMeeting() {
        var meetingID = document.getElementById('organizerCancelMeetingID').value;
        var secretCode = document.getElementById('cancelMeetingSecretKey').value;
        $("body").css("cursor", "progress");


        var organizerDeleteMeetingData = {
            'meetingID': meetingID,
            'orginizerSecretCode': secretCode
        };

        var xhr = new XMLHttpRequest();
        xhr.open("POST", deleteMeetingOrganizerURL, true);

        var stringified = JSON.stringify(organizerDeleteMeetingData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                $("body").css("cursor", "default");
                console.log("XHR:" + xhr.responseText);
                var jsonResponse = JSON.parse(xhr.responseText);

                if (jsonResponse.httpCode == 500)
                    document.getElementById('scheduleMeetingErrorMessage').innerText = "Error canceling meeting by organizer";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('organizerDeleteReload').style.display = "block";
                    document.getElementById('organizerDeleteErrorMessage').innerText = "Meeting Canceled by Organizer";

                }
                else
                    alert(jsonResponse.message);

            }
        };
    }

    function chooseOpenClose() {
        if (document.getElementById('closeOpenH3').innerText == 'Close Timeslot') {
            organizerCloseMeeting()
        } else {
            organizerOpenMeeting()
        }
    }

    function organizerCloseMeeting() {
        var timeSlotID = document.getElementById('organizerCloseMeetingID').value;
        var secretCode = document.getElementById('closeMeetingSecretKey').value;
        $("body").css("cursor", "progress");


        var organizerDeleteMeetingData = {
            'timeSlotID': timeSlotID,
            'originizerSecretCode': secretCode
        };

        var xhr = new XMLHttpRequest();
        xhr.open("POST", closeMeetingOrganizerURL, true);

        var stringified = JSON.stringify(organizerDeleteMeetingData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                $("body").css("cursor", "default");
                console.log("XHR:" + xhr.responseText);
                var jsonResponse = JSON.parse(xhr.responseText);

                if (jsonResponse.httpCode == 500)
                    document.getElementById('organizerCloseErrorMessage').innerText = "Error closing timeslot by organizer";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('organizerCloseReload').style.display = "block";
                    document.getElementById('organizerCloseErrorMessage').innerText = "Timeslot Successfully Closed by Organizer";

                }
                else
                    alert(jsonResponse.message);

            }
        };
    }

    function organizerOpenMeeting() {
        var timeSlotID = document.getElementById('organizerCloseMeetingID').value;
        var secretCode = document.getElementById('closeMeetingSecretKey').value;
        $("body").css("cursor", "progress");


        var organizerDeleteMeetingData = {
            'timeSlotID': timeSlotID,
            'originizerSecretCode': secretCode
        };

        var xhr = new XMLHttpRequest();
        xhr.open("POST", openMeetingOrganizerURL, true);

        var stringified = JSON.stringify(organizerDeleteMeetingData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                $("body").css("cursor", "default");
                console.log("XHR:" + xhr.responseText);
                var jsonResponse = JSON.parse(xhr.responseText);

                if (jsonResponse.httpCode == 500)
                    document.getElementById('organizerCloseErrorMessage').innerText = "Error opening timeslot by organizer";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('organizerCloseReload').style.display = "block";
                    document.getElementById('organizerCloseErrorMessage').innerText = "Timeslot Successfully Opened by Organizer";

                }
                else
                    alert(jsonResponse.message);

            }
        };
    }

    function adminDeleteSchedules() {
        var deleteDaysBefore = document.getElementById('deleteDaysBefore').value;
        document.getElementById('adminDeleteMessage').innerText = "";

        if(deleteDaysBefore == '') {
            document.getElementById('adminDeleteMessage').innerText = "Please enter an integer";
            return;
        }
        $("body").css("cursor", "progress");


        var organizerDeleteMeetingData = {
            'daysPassed': deleteDaysBefore
        };

        var xhr = new XMLHttpRequest();
        xhr.open("POST", adminDeleteURL, true);

        var stringified = JSON.stringify(organizerDeleteMeetingData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                $("body").css("cursor", "default");
                console.log("XHR:" + xhr.responseText);
                var jsonResponse = JSON.parse(xhr.responseText);

                if (jsonResponse.httpCode == 500)
                    document.getElementById('adminDeleteMessage').innerText = "Error deleting schedules";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('adminDeleteReload').style.display = "block";
                    document.getElementById('adminDeleteMessage').innerText =  jsonResponse.numDeleted + " Schedules Successfully Deleted.";

                }
                else
                    alert(jsonResponse.message);
            }
        };
    }

    function clearDiv(){
        document.getElementById('adminResultDiv').innerHTML = '';
        document.getElementById('adminGetSchedulesMessage').innerHTML = '';
        document.getElementById('adminGetReload').style.display = 'none';
    }

    function getAdminSchedules() {
        var getSchedulesCreatedIn = document.getElementById('getCreated').value;
        document.getElementById('adminGetSchedulesMessage').innerText = "";

        if(deleteDaysBefore == '') {
            document.getElementById('adminGetSchedulesMessage').innerText = "Please enter an integer";
            return;
        }
        $("body").css("cursor", "progress");


        var organizerGetScheduleData = {
            'hoursPassed': getSchedulesCreatedIn
        };

        var xhr = new XMLHttpRequest();
        xhr.open("POST", adminGetURL, true);

        var stringified = JSON.stringify(organizerGetScheduleData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                $("body").css("cursor", "default");
                console.log("XHR:" + xhr.responseText);
                var jsonResponse = JSON.parse(xhr.responseText);

                if (jsonResponse.httpCode == 500)
                    document.getElementById('adminGetSchedulesMessage').innerText = "Error deleting schedules";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('adminGetReload').style.display = "block";
                    var numGot = jsonResponse.schedules.length;
                    if(numGot > 0) {
                        buildAdminDiv(jsonResponse);
                        document.getElementById('adminGetSchedulesMessage').innerText = numGot + " Schedules Pulled.";
                    }else{
                        document.getElementById('adminGetSchedulesMessage').innerText = "The function worked but there are no schedules. This site just doesn't get the traffic it used to.";
                    }
                }
                else
                    alert(jsonResponse.message);
            }
        };
    }

    function buildAdminDiv(someJS){

        document.getElementById("adminResultDiv").style.display = 'block';
        var body = document.getElementById("adminResultDiv");

        // creates a <table> element and a <tbody> element
        var tbl = document.createElement("table");
        var tblBody = document.createElement("tbody");

        var firstRowBuilt = false;

        // creating all cells
        for (var i = 0; i < someJS.schedules.length; i++) {
            // creates a table row
            var aSchedule = someJS.schedules[i];
            var row = document.createElement("tr");

            if (!firstRowBuilt) {
                firstRowBuilt = true;
                var topRow = document.createElement("tr");
                var cell1 = document.createElement("td");
                var cell2 = document.createElement("td");
                var cell3 = document.createElement("td");
                var cell4 = document.createElement("td");
                var cell5 = document.createElement("td");
                var cellText1 = document.createTextNode("Selection Name");
                var cellText2 = document.createTextNode("Schedule ID");
                var cellText3 = document.createTextNode("Start Date");
                var cellText4 = document.createTextNode("End Date");
                var cellText5 = document.createTextNode("Time Created");
                cell1.appendChild(cellText1);
                cell2.appendChild(cellText2);
                cell3.appendChild(cellText3);
                cell4.appendChild(cellText4);
                cell5.appendChild(cellText5);
                topRow.appendChild(cell1);
                topRow.appendChild(cell2);
                topRow.appendChild(cell3);
                topRow.appendChild(cell4);
                topRow.appendChild(cell5);

                tblBody.appendChild(topRow);
            }

            var cell1 = document.createElement("td");
            var cell2 = document.createElement("td");
            var cell3 = document.createElement("td");
            var cell4 = document.createElement("td");
            var cell5 = document.createElement("td");

            var timeslotDateStart = new Date(aSchedule.startDate.year, parseInt(aSchedule.startDate.month) - 1, aSchedule.startDate.day)
            var timeslotDateEnd = new Date(aSchedule.endDate.year, parseInt(aSchedule.endDate.month) - 1, aSchedule.endDate.day)
            var timeSlotCreation = aSchedule.creationDate.time.hour + ":" + aSchedule.creationDate.time.minute + ' ' + aSchedule.creationDate.date.month + '/'
                + aSchedule.creationDate.date.day + "/" + aSchedule.creationDate.date.year;

            var cellText1 = document.createTextNode(aSchedule.scheduleName);
            var cellText2 = document.createTextNode(aSchedule.scheduleID);
            var cellText3 = document.createTextNode(timeslotDateStart.toDateString());
            var cellText4 = document.createTextNode(timeslotDateEnd.toDateString());
            var cellText5 = document.createTextNode(timeSlotCreation);

            cell1.appendChild(cellText1);
            cell2.appendChild(cellText2);
            cell3.appendChild(cellText3);
            cell4.appendChild(cellText4);
            cell5.appendChild(cellText5);
            row.appendChild(cell1);
            row.appendChild(cell2);
            row.appendChild(cell3);
            row.appendChild(cell4);
            row.appendChild(cell5);

            // add the row to the end of the table body
            tblBody.appendChild(row);
            document.getElementById("adminResultDiv").style.display = 'block';
        }

        // put the <tbody> in the <table>
        tbl.appendChild(tblBody);
        // appends <table> into <body>

        tbl.setAttribute("width", "100%");
        tbl.setAttribute("margin-right", "auto");
        tbl.setAttribute("margin-left", "auto");
        body.appendChild(tbl);
        // sets the border attribute of tbl to 2;
        tbl.setAttribute("border", "2");


    }

    function reload(){
        document.getElementById('adminDeleteMessage').innerText = "";
        location.reload();
    }

    function hideDivs() {
        document.getElementById('meetingDiv').style.display = 'none';
        document.getElementById('confirmMeetingForm').style.display = 'none';
        document.getElementById("cancelMeetingDiv").style.display = "none";
        document.getElementById("organizerDeleteReload").style.display = "none";
        document.getElementById("cancelScheduleMeetingErrorMessage").value = "";
        document.getElementById("organizerCloseReload").style.display = "none";
        document.getElementById("extendStartEndDateReload").style.display = "none";
        document.getElementById("adminDeleteReload").style.display = "none";
        document.getElementById("closeOpenTimeslotsDayReload").style.display = "none";
        document.getElementById("closeOpenTimeDayReload").style.display = "none";
        document.getElementById("cancelScheduleMeetingErrorMessage").value = "";
        document.getElementById("closeOpenTimeslotsDayMessage").value = "";
        document.getElementById("closeOpenTimeSecretKey").value = "";
        document.getElementById("closeOpenTimeDayMessage").value = "";
        document.getElementById("extendStartEndDateMessage").innerText = "";
        document.getElementById("adminGetSchedulesMessage").innerText = "";
        document.getElementById("cancelMeetingSecretKey").value = "";
        document.getElementById("closeMeetingSecretKey").value = "";
        document.getElementById("organizerDeleteErrorMessage").innerText = "";
        document.getElementById("confirmCancelMeetingForm").value = "";
        document.getElementById("meetingSecretKey").value = "";
        document.getElementById("organizerCloseMeetingID").value = "";
        document.getElementById("closeOpenTimeslotDate").value = "";
        document.getElementById("extendStartEndDateSelect").value = "";
        document.getElementById("organizerCloseErrorMessage").innerText = "";
        document.getElementById('closeOpenH3').innerText = 'Close/Open TimeSlot';
        document.getElementById('closeOpenTimeslotsDayMessage').innerText = '';
        document.getElementById('closeOpenTimeDayMessage').innerText = '';

    }


    function noScheduleFound() {
        document.getElementById("scheduleForm").style.visibility = "visible";
        document.getElementById("createScheduleDiv").style.visibility = "visible";
        document.getElementById('errMessage').innerText = 'No Schedule with an id of ' + document.getElementById("scheduleID").value + ' found. Try again or create your own.';
        document.getElementById("scheduleID").value = '';
    }


    function deleteSchedule() {
        var secretKey = document.getElementById('secretKey').value;
        var scheduleID = document.getElementById('scheduleIDDelete').value;
        $("body").css("cursor", "progress");


        var deleteScheduleData = {
            'scheduleID': scheduleID,
            'originizerSecretCode': secretKey
        };

        var xhr = new XMLHttpRequest();
        xhr.open("POST", deleteURL, true);

        var stringified = JSON.stringify(deleteScheduleData);

        xhr.send(stringified);
        xhr.onloadend = function () {
            console.log(xhr);
            console.log(xhr.request);

            if (xhr.readyState == XMLHttpRequest.DONE) {
                $("body").css("cursor", "default");
                console.log("XHR:" + xhr.responseText);
                var jsonResponse = JSON.parse(xhr.responseText);

                if (jsonResponse.httpCode == 500)
                    document.getElementById('deleteErrorMessage').innerText = "Values do not match up.";
                else if (jsonResponse.httpCode == 200) {
                    document.getElementById('deleteErrorMessage').innerText = "Delete Successful. Refreshing in 3 seconds";
                    setTimeout(function () {
                        window.location.reload();
                    }, 3000);
                }
                else
                    alert(jsonResponse.message);

            }
        };
    }

    function toggleOrganizerDiv() {
        var meetingButtons = document.getElementsByClassName('meetingButton');
        if (document.getElementById("organizerDiv").style.display == "none") {
            document.getElementById("organizerDiv").style.display = "block";
            document.getElementById("filterDiv").style.display = "none";
            document.getElementById("adminDiv").style.display = "none";
            for (var x = 0; x < meetingButtons.length; x++) {
                if (meetingButtons[x].innerText == 'CLOSED')
                    meetingButtons[x].disabled = false;
            }
            hideDivs();
        } else {
            document.getElementById("organizerDiv").style.display = "none";
            for (var x = 0; x < meetingButtons.length; x++) {
                if (meetingButtons[x].innerText == 'CLOSED')
                    meetingButtons[x].disabled = true;
            }
        }
    }

    function toggleFilterDiv() {
        if (document.getElementById("filterDiv").style.display == "none") {
            document.getElementById("organizerDiv").style.display = "none";
            document.getElementById("adminDiv").style.display = "none";
            document.getElementById("filterDiv").style.display = "block";

            hideDivs();
        } else {
            document.getElementById("filterDiv").style.display = "none";
            document.getElementById("filterDivResults").innerHTML = '';
            document.getElementById('filterMessage').style.display = 'none';

        }
    }

    function toggleAdminDiv() {
        if (document.getElementById("adminDiv").style.display == "none") {
            document.getElementById("organizerDiv").style.display = "none";
            document.getElementById("filterDiv").style.display = "none";
            document.getElementById("adminDiv").style.display = "block";

            hideDivs();
        } else {
            document.getElementById("adminDiv").style.display = "none";
            document.getElementById("adminResultDiv").innerHTML = '';
            document.getElementById('adminMessage').style.display = 'none';

        }
    }


</script>

</body>
</html>