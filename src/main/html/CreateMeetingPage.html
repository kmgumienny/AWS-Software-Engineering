<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Create Meeting</title>
</head>
<body>
<h1 style="text-align: center" id="title">Organizer, create schedule!</h1>
<div style="text-align: center; margin-top: 5%;">
    <form id="scheduleForm" name="scheduleForm">
        <label style="margin-bottom: 15px; display: block;">
            Schedule Name:
            <input id="scheduleName" type="text" required>

        </label>

        <br>
        <label style="margin-bottom: 15px; display: block;">
        Start Date:
        <input id="startDate" type="date" required>
        </label>

        <br>
        <label style="margin-bottom: 15px; display: block;">
        End Date:
        <input id="endDate" type="date" required>
        </label>

        <br>
        <label style="margin-bottom: 15px; display: block;">
        Start Time:
            <select id="startTime" name="startTime">
                <option value=9>9 AM</option>
                <option value=10>10 AM</option>
                <option value=11>11 AM</option>
                <option value=12>12 PM</option>
                <option value=13>1 PM</option>
                <option value=14>2 PM</option>
                <option value=15>3 PM</option>
                <option value=16>4 PM</option>
                <option value=17>5 PM</option>
                <option value=18>6 PM</option>
                <option value=19">7 PM</option>
                <option value=20>8 PM</option>
                <option value=21>9 PM</option>
            </select>
        </label>

        <label style="margin-bottom: 15px; display: block;">
        <br>
        End Time:
            <select id="endTime" name="endTime">
                <option value=10>10 AM</option>
                <option value=11>11 AM</option>
                <option value=12>12 PM</option>
                <option value=13>1 PM</option>
                <option value=14>2 PM</option>
                <option value=15>3 PM</option>
                <option value=16>4 PM</option>
                <option value=17>5 PM</option>
                <option value=18>6 PM</option>
                <option value=19>7 PM</option>
                <option value=20>8 PM</option>
                <option value=21>9 PM</option>
            </select>
        <br>
        </label>

        <label style="margin-bottom: 15px; display: block;">
            <br>
            Time Increments (in Minutes):
            <select id="increment" name="increment">
                <option value="10">10</option>
                <option value="15">15</option>
                <option value="20">20</option>
                <option value="30">30</option>
                <option value="60">60</option>
            </select>
            <br>
        </label>

        <label style="margin-bottom: 15px; display: block;">
            <input id="createButton" type="button" value="Submit"  onClick="JavaScript:handleCreateClick(this)">
            <br>
        </label>

        <label id="key" style="margin-bottom: 15px; visibility: hidden; display: block;">
            Your key is:
            <input id="keyField" style="" readonly />
            <br>
        </label>

        <label id="keyLabel" style="margin-bottom: 15px; display: block; visibility: hidden">
            <br>
            Enter Key to see Schedule
            <input id="keyID" type="text" required>
            <input type="button" value="submit" onClick="JavaScript:handleCreateSchedule()">

            <br>
        </label>
    </form>
</div>
<div>
    <p id="dateP"></p>
</div>

<div id="calendarDiv" style="text-align: center; margin-top: 5%;">

</div>

<div style="position: fixed; left: 0; bottom: 15px; width: 100%; color: white; text-align: center;">
    <a href="./AdminPanel.html">Enter the Admin Panel by clicking here!</a>
</div>

<script>

    var createURL = "https://xu9qdlrt29.execute-api.us-east-2.amazonaws.com/Alpha/createschedule";
    var data = {};

    function handleCreateSchedule(){
        var keyEntered = document.getElementById("keyID").value;
        if (keyEntered == "abc123"){
            document.getElementById("scheduleForm").style.display = "none";
            document.getElementById("title").innerText = data.scheduleName + " Schedule";
            //alert(typeof data.startDate);
            var startDate = new Date(data.startDate);
            var endDate = new Date(data.endDate);

            var numDays = (endDate - startDate)/86400000;
            //0=sunday, 6= saturday
            var startDay = startDate.getDay();
            var checkDay = new Date(data.startDate);
            var curr = new Date(data.startDate);


            var startTime = data.startTime;
            var endTime = data.endTime;
            var increment = data.increment;

            var numMeetings = ((endTime - startTime)*60)/increment;
            console.log(numMeetings);
            var nonDays = [];

            //setDate(startDate);

            for(var i = 0; i < numDays; i++){
                //alert(checkDay.getDate() + i + " " + (checkDay.getDate() + i) % 7);
                if((checkDay.getDate() + i)% 7 == 0 || (checkDay.getDate() + i)% 7 == 6) {
                    nonDays.push(checkDay.getDate() + i);
                    //alert(nonDays.length);
                }
            }

            var calDiv = document.getElementById("calendarDiv");

            var ourTable     = document.createElement("table");
            var ourTableBody = document.createElement("tbody");


            for (var i = startDate.getDay(); i < 6; i++) {

                var row = document.createElement("tr");

                for (var j = 0; j <numMeetings; j++) {


                    var cell = document.createElement("td");
                    var cellText = document.createElement("button");
                    cellText.innerHTML = "Create Meeting";
                    cell.appendChild(cellText);
                    row.appendChild(cell);
                }


                ourTableBody.appendChild(row);
            }


            ourTable.appendChild(ourTableBody);

            calDiv.appendChild(ourTable);

            ourTable.setAttribute("border", "2");

            }

        var first = curr.getDate() - curr.getDay(); // First day is the day of the month - the day of the week
        var last = first + 6; // last day is the first day + 6

        var firstday = new Date(curr.setDate(first)).toUTCString();
        var lastday = new Date(curr.setDate(last)).toUTCString();


        alert(firstday + " to " + lastday);



    }

    function setDate(curr){
        var first = curr.getDate() - curr.getDay(); // First day is the day of the month - the day of the week
        var last = first + 6; // last day is the first day + 6

        var firstday = new Date(curr.setDate(first)).toUTCString();
        var lastday = new Date(curr.setDate(last)).toUTCString();


        alert(firstday + " to " + lastday);
    }


    function handleCreateClick(e) {

        var arg1 = document.getElementById('scheduleName').value;
        var arg2 = document.getElementById('startDate').value;
        var arg3 = document.getElementById('endDate').value;
        var arg4 = +document.getElementById('startTime').value;
        var arg5 = +document.getElementById('endTime').value;
        var arg6 = +document.getElementById('increment').value;

        if (arg3 < arg2){
            alert ("Error! Please modify the start and end dates to continue");
        }

        else if (arg4 >= arg5){
            alert("Error! Please modify the start and end times to continue");
        }
        else{
            //alert(arg1 + " " + arg2 + " " + arg3 + " " + arg4 + " " + arg5 + " " + arg6);

            data["scheduleName"] = arg1;
            data["startDate"] = arg2;
            data["endDate"] = arg3;
            data["startTime"] = arg4;
            data["endTime"] = arg5;
            data["increment"] = arg6;

            document.getElementById("createButton").disabled = true;
            document.getElementById("keyField").value= "abc123";
            document.getElementById("key").style.visibility = "visible";
            document.getElementById("keyLabel").style.visibility = "visible";

            var js = JSON.stringify(data);
            var xhr = new XMLHttpRequest();
            xhr.open("POST", createURL, true);

            // send the collected data as JSON
            xhr.send(js);

            // This will process results and update HTML as appropriate.
            xhr.onloadend = function () {
                console.log(xhr);
                console.log(xhr.request);

                if (xhr.readyState == XMLHttpRequest.DONE) {
                    console.log ("XHR:" + xhr.responseText);
                    //alert("Success!");


                    // function handleAddClick(e) {
                    //     var form = document.addForm;
                    //     var arg1 = form.arg1.value;
                    //     var arg2 = form.arg2.value;
                    //
                    //     var data = {};
                    //     data["arg1"] = arg1;
                    //     data["arg2"] = arg2;
                    //
                    //     var js = JSON.stringify(data);
                    //     console.log("JS:" + js);
                    //     var xhr = new XMLHttpRequest();
                    //     xhr.open("POST", add_url, true);
                    //
                    //     // send the collected data as JSON
                    //     xhr.send(js);
                    //
                    //     // This will process results and update HTML as appropriate.
                    //     xhr.onloadend = function () {
                    //         console.log(xhr);
                    //         console.log(xhr.request);
                    //
                    //         if (xhr.readyState == XMLHttpRequest.DONE) {
                    //             console.log ("XHR:" + xhr.responseText);
                    //             processAddResponse(arg1, arg2, xhr.responseText);
                    //         } else {
                    //             processAddResponse(arg1, arg2, "N/A");
                    //         }
                    //     };
                    // }

                }
            };
        }
    }

    // function confirmCopy() {
    //     var code = 'abc123';
    //     var ask = window.confirm("The following is your code " + code + ". \n " +
    //         "Confirm Once you have copied it as you will need it to view schedule");
    //     if (ask) {
    //
    //         //window.location.href = "/landingPage.html";
    //
    //     }
    // }



</script>

</body>
</html>